import React, { useState, useEffect } from 'react';
import { Calendar, Edit2, Camera, Gift, Sparkles } from 'lucide-react';

const KoreanQuizApp = () => {
  const [user, setUser] = useState({
    name: 'í•™ìŠµì',
    profileEmoji: 'ğŸ“',
    level: 1,
    exp: 0,
    streak: 0,
    totalPoints: 0,
    lastVisit: null,
    attendanceHistory: {},
    quizHistory: {}
  });

  const [currentQuiz, setCurrentQuiz] = useState(null);
  const [selectedAnswer, setSelectedAnswer] = useState(null);
  const [showResult, setShowResult] = useState(false);
  const [editingName, setEditingName] = useState(false);
  const [tempName, setTempName] = useState(user.name);
  const [showEmojiPicker, setShowEmojiPicker] = useState(false);
  const [showAttendanceCalendar, setShowAttendanceCalendar] = useState(false);
  const [selectedCategory, setSelectedCategory] = useState(null);
  const [calendarMonth, setCalendarMonth] = useState(new Date().getMonth());
  const [calendarYear, setCalendarYear] = useState(new Date().getFullYear());

  const emojis = ['ğŸ“', 'ğŸ˜Š', 'ğŸ±', 'ğŸ¶', 'ğŸ¦Š', 'ğŸ»', 'ğŸ¼', 'ğŸ¦', 'ğŸ¯', 'ğŸ¦„', 'ğŸŒŸ', 'â­', 'ğŸ’«', 'âœ¨', 'ğŸ¨', 'ğŸ®'];

  const quizData = {
    daily: {
      beginner: [
        { id: 1, question: 'ì•ˆë…•í•˜ì„¸ìš”ì˜ ì˜ë¯¸ëŠ”?', answers: ['ë§Œë‚¬ì„ ë•Œ í•˜ëŠ” ì¸ì‚¬ë§', 'í—¤ì–´ì§ˆ ë•Œ í•˜ëŠ” ì¸ì‚¬ë§', 'ê³ ë§ˆì›€ì„ í‘œí˜„í•˜ëŠ” ë§', 'ë¯¸ì•ˆí•¨ì„ í‘œí˜„í•˜ëŠ” ë§'], correct: 0 },
        { id: 2, question: 'ê°ì‚¬í•©ë‹ˆë‹¤ëŠ” ë¬´ìŠ¨ ëœ»ì¼ê¹Œìš”?', answers: ['ì‹¤ë¡€ë¥¼ êµ¬í•  ë•Œ ì“°ëŠ” ë§', 'ê³ ë§ˆì›€ì„ í‘œí˜„í•˜ëŠ” ë§', 'ë¶€íƒí•  ë•Œ ì“°ëŠ” ë§', 'í™˜ì˜í•  ë•Œ ì“°ëŠ” ë§'], correct: 1 },
        { id: 3, question: 'ë¬¼ì„ ì„¤ëª…í•˜ë©´?', answers: ['ìŒì‹', 'ë§ˆì‹œëŠ” íˆ¬ëª…í•œ ì•¡ì²´', 'ìŒ€ë¡œ ë§Œë“  ìŒì‹', 'ì°¨'], correct: 1 },
        { id: 4, question: 'ë°¥ì˜ ì˜ë¯¸ëŠ”?', answers: ['êµ­', 'ìŒ€ë¡œ ì§€ì€ ìŒì‹ ë˜ëŠ” ì‹ì‚¬', 'ë¹µ', 'êµ­ìˆ˜'], correct: 1 },
        { id: 5, question: 'ì¹œêµ¬ëŠ” ë¬´ìŠ¨ ëœ»ì¼ê¹Œìš”?', answers: ['ê°€ì¡±', 'ê°€ê¹Œì´ ì§€ë‚´ëŠ” ì‚¬ëŒ', 'ì„ ìƒë‹˜', 'í•™ìƒ'], correct: 1 },
        { id: 6, question: 'í•™êµë¥¼ ì„¤ëª…í•˜ë©´?', answers: ['ë°°ìš°ëŠ” ê³³', 'ì‚¬ëŠ” ê³³', 'ë†€ì´í„°', 'ë¬¼ê±´ ì‚¬ëŠ” ê³³'], correct: 0 },
        { id: 7, question: 'ì‚¬ë‘ì˜ ì˜ë¯¸ëŠ”?', answers: ['ì‹«ì–´í•˜ëŠ” ë§ˆìŒ', 'ì¢‹ì•„í•˜ëŠ” ë§ˆìŒ', 'ì•„ì£¼ ê¹Šì´ ì¢‹ì•„í•˜ëŠ” ë§ˆìŒ', 'í™”ë‚œ ê°ì •'], correct: 2 },
        { id: 8, question: 'ì±…ì„ ì„¤ëª…í•˜ë©´?', answers: ['ê¸€ì”¨ ì“°ëŠ” ë„êµ¬', 'ì¢…ì´', 'ê¸€ê³¼ ê·¸ë¦¼ì´ ìˆëŠ” ê²ƒ', 'ì•‰ëŠ” ê³³'], correct: 2 },
      ],
      intermediate: [
        { id: 9, question: 'ì•½ì†ì˜ ì˜ë¯¸ëŠ”?', answers: ['ì•½', 'ë¯¸ë¦¬ ì •í•œ ì‹œê°„ì´ë‚˜ ì¼', 'ì•½ì ', 'ë³‘ì›'], correct: 1 },
        { id: 10, question: 'ì•„ê¹Œì›Œí•˜ë‹¤ëŠ” ë¬´ìŠ¨ ëœ»ì¼ê¹Œìš”?', answers: ['ë²„ë¦¬ê¸° ì•ˆíƒ€ê¹Œìš´ ë§ˆìŒ', 'í™”ë‚˜ëŠ” ë§ˆìŒ', 'ê¸°ìœ ë§ˆìŒ', 'í”¼ê³¤í•œ ë§ˆìŒ'], correct: 0 },
        { id: 11, question: 'ì„¤ë ˆë‹¤ì˜ ëœ»ì€?', answers: ['ìŠ¬í”ˆ ë§ˆìŒ', 'ê¸°ëŒ€ë˜ì–´ ê°€ìŠ´ì´ ë‘ê·¼ê±°ë¦¼', 'í˜¼ë€ìŠ¤ëŸ¬ìš´ ìƒíƒœ', 'ì¡¸ë¦° ìƒíƒœ'], correct: 1 },
        { id: 12, question: 'ë¶€ë„ëŸ½ë‹¤ëŠ” ë¬´ìŠ¨ ëœ»ì¼ê¹Œìš”?', answers: ['ìë‘ìŠ¤ëŸ¬ìš´', 'ì°½í”¼í•˜ê±°ë‚˜ ì‘¥ìŠ¤ëŸ¬ìš´', 'ìì‹  ìˆëŠ”', 'ìš©ê°í•œ'], correct: 1 },
        { id: 13, question: 'ê·¸ë¦½ë‹¤ì˜ ì˜ë¯¸ëŠ”?', answers: ['ê·¸ë¦¼ì„ ê·¸ë¦¬ë‹¤', 'ë³´ê³  ì‹¶ê³  ìƒê°ë‚˜ë‹¤', 'ì¡ë‹¤', 'ë³´ë‹¤'], correct: 1 },
        { id: 14, question: 'ì„œìš´í•˜ë‹¤ëŠ” ë¬´ìŠ¨ ëœ»ì¼ê¹Œìš”?', answers: ['ê¸°ìœ', 'ì„­ì„­í•˜ê³  ì•„ì‰¬ìš´', 'ì‹ ë‚˜ëŠ”', 'ê±±ì •ë˜ëŠ”'], correct: 1 },
        { id: 15, question: 'ë‹µë‹µí•˜ë‹¤ì˜ ëœ»ì€?', answers: ['ë§‰í˜€ì„œ ë¶ˆí¸í•˜ê±°ë‚˜ ê°‘ê°‘í•œ', 'í¸ì•ˆí•œ', 'ë„“ì€', 'ë§‘ì€'], correct: 0 },
      ],
      advanced: [
        { id: 16, question: 'ëˆˆì¹˜ê°€ ë¹ ë¥´ë‹¤ëŠ” ë¬´ìŠ¨ ì˜ë¯¸ì¸ê°€ìš”?', answers: ['ë‹¬ë¦¬ê¸°ë¥¼ ì˜í•¨', 'ìƒí™©ì„ ë¹¨ë¦¬ íŒŒì•…í•¨', 'ì‹œë ¥ì´ ì¢‹ìŒ', 'ê³µë¶€ë¥¼ ì˜í•¨'], correct: 1 },
        { id: 17, question: 'ì†ì´ í¬ë‹¤ì˜ ê´€ìš©ì  ì˜ë¯¸ëŠ”?', answers: ['ì†ì˜ í¬ê¸°ê°€ í¼', 'ì¸ì‹¬ì´ í›„í•˜ê³  ë² í’‚ì´ ë§ìŒ', 'í˜ì´ ì…ˆ', 'ë¬¼ê±´ì„ ì˜ ë–¨ì–´ëœ¨ë¦¼'], correct: 1 },
        { id: 18, question: 'ë°œì´ ë„“ë‹¤ëŠ” ë¬´ìŠ¨ ëœ»ì¼ê¹Œìš”?', answers: ['ë°œì˜ í¬ê¸°ê°€ í¼', 'ì•„ëŠ” ì‚¬ëŒì´ ë§ê³  ì¸ë§¥ì´ ë„“ìŒ', 'í‚¤ê°€ í¼', 'ê±·ëŠ” ì†ë„ê°€ ë¹ ë¦„'], correct: 1 },
        { id: 19, question: 'ê·€ê°€ ì–‡ë‹¤ì˜ ì˜ë¯¸ëŠ”?', answers: ['ê·€ê°€ ì–‡ìŒ', 'ë‚¨ì˜ ë§ì„ ì‰½ê²Œ ë¯¿ìŒ', 'ì²­ë ¥ì´ ì¢‹ìŒ', 'ë‚¨ì˜ ë§ì„ ì•ˆ ë“¤ìŒ'], correct: 1 },
        { id: 20, question: 'ì…ì´ ë¬´ê²ë‹¤ëŠ” ë¬´ìŠ¨ ëœ»ì¼ê¹Œìš”?', answers: ['ì…ìˆ ì´ ë¬´ê±°ì›€', 'ë¹„ë°€ì„ ì˜ ì§€í‚´', 'ë§ì„ ë§ì´ í•¨', 'ì… ëƒ„ìƒˆê°€ ë‚¨'], correct: 1 },
      ]
    }
  };

  useEffect(() => {
    checkAttendance();
  }, []);

  const checkAttendance = () => {
    const today = new Date().toDateString();
    
    if (user.lastVisit !== today) {
      const yesterday = new Date();
      yesterday.setDate(yesterday.getDate() - 1);
      
      const newAttendance = { ...user.attendanceHistory };
      newAttendance[today] = true;
      
      if (user.lastVisit === yesterday.toDateString()) {
        setUser({...user, streak: user.streak + 1, lastVisit: today, attendanceHistory: newAttendance});
      } else {
        setUser({...user, streak: 1, lastVisit: today, attendanceHistory: newAttendance});
      }
    }
  };

  const getStreakReward = (streak) => {
    if (streak >= 30) return { icon: 'ğŸ†', text: '30ì¼ ì—°ì† ë‹¬ì„±!', points: 500 };
    if (streak >= 14) return { icon: 'ğŸ’', text: '2ì£¼ ì—°ì† ë‹¬ì„±!', points: 200 };
    if (streak >= 7) return { icon: 'â­', text: 'ì¼ì£¼ì¼ ì—°ì† ë‹¬ì„±!', points: 100 };
    if (streak >= 3) return { icon: 'ğŸ¯', text: '3ì¼ ì—°ì† ë‹¬ì„±!', points: 30 };
    return null;
  };

  const getCalendarDays = () => {
    const firstDay = new Date(calendarYear, calendarMonth, 1);
    const lastDay = new Date(calendarYear, calendarMonth + 1, 0);
    const daysInMonth = lastDay.getDate();
    const startingDayOfWeek = firstDay.getDay();
    
    const days = [];
    
    for (let i = 0; i < startingDayOfWeek; i++) {
      days.push({ date: null, isEmpty: true });
    }
    
    for (let day = 1; day <= daysInMonth; day++) {
      const date = new Date(calendarYear, calendarMonth, day);
      const dateString = date.toDateString();
      const today = new Date().toDateString();
      days.push({
        date: day,
        attended: user.attendanceHistory[dateString] || false,
        isToday: dateString === today,
        isEmpty: false
      });
    }
    
    return days;
  };

  const goToPreviousMonth = () => {
    if (calendarMonth === 0) {
      setCalendarMonth(11);
      setCalendarYear(calendarYear - 1);
    } else {
      setCalendarMonth(calendarMonth - 1);
    }
  };

  const goToNextMonth = () => {
    if (calendarMonth === 11) {
      setCalendarMonth(0);
      setCalendarYear(calendarYear + 1);
    } else {
      setCalendarMonth(calendarMonth + 1);
    }
  };

  const getMonthName = (month) => {
    const months = ['1ì›”', '2ì›”', '3ì›”', '4ì›”', '5ì›”', '6ì›”', '7ì›”', '8ì›”', '9ì›”', '10ì›”', '11ì›”', '12ì›”'];
    return months[month];
  };

  const startQuiz = (category, difficulty) => {
    const quizzes = quizData.daily[difficulty];
    const randomQuiz = quizzes[Math.floor(Math.random() * quizzes.length)];
    setCurrentQuiz({ ...randomQuiz, category: 'daily', difficulty });
    setSelectedAnswer(null);
    setShowResult(false);
    setSelectedCategory(null);
  };

  const handleAnswer = (answerIndex) => {
    setSelectedAnswer(answerIndex);
  };

  const submitAnswer = () => {
    if (selectedAnswer === null) return;
    
    const isCorrect = selectedAnswer === currentQuiz.correct;
    const basePoints = currentQuiz.difficulty === 'advanced' ? 15 : currentQuiz.difficulty === 'intermediate' ? 12 : 10;
    const points = isCorrect ? basePoints : 0;
    
    setShowResult(true);
    
    if (isCorrect) {
      const today = new Date().toDateString();
      const newExp = user.exp + points;
      const newLevel = Math.floor(newExp / 50) + 1;
      const newPoints = user.totalPoints + points;
      const newQuizHistory = { ...user.quizHistory, [today]: true };
      
      setUser({
        ...user,
        exp: newExp,
        level: Math.min(newLevel, 10),
        totalPoints: newPoints,
        quizHistory: newQuizHistory
      });
    }
  };

  const saveName = () => {
    if (tempName.trim()) {
      setUser({ ...user, name: tempName.trim() });
      setEditingName(false);
    }
  };

  const selectEmoji = (emoji) => {
    setUser({ ...user, profileEmoji: emoji });
    setShowEmojiPicker(false);
  };

  const getLevelName = (level) => {
    if (level >= 9) return 'ì „ë¬¸ê°€';
    if (level >= 7) return 'ê³ ê¸‰';
    if (level >= 5) return 'ì¤‘ê¸‰';
    if (level >= 3) return 'ì´ˆê¸‰';
    return 'ì…ë¬¸';
  };

  const getProgressPercent = () => {
    const expInLevel = user.exp % 50;
    return (expInLevel / 50) * 100;
  };

  const getDifficultyText = (difficulty) => {
    if (difficulty === 'beginner') return 'ì´ˆê¸‰';
    if (difficulty === 'intermediate') return 'ì¤‘ê¸‰';
    return 'ìƒê¸‰';
  };

  if (!currentQuiz && !selectedCategory) {
    return (
      <div style={{ backgroundColor: '#f0f0f0', minHeight: '100vh', fontFamily: "'Noto Sans KR', -apple-system, BlinkMacSystemFont, sans-serif" }}>
        <div style={{ maxWidth: '430px', margin: '0 auto' }}>
          {/* í—¤ë” */}
          <div style={{ backgroundColor: '#ffffff', padding: '20px', textAlign: 'center', boxShadow: '0 2px 4px rgba(0,0,0,0.05)' }}>
            <div style={{ fontSize: '42px', fontWeight: '700', color: '#6BA3D4', letterSpacing: '1px', fontFamily: "'Arial Rounded MT Bold', Arial, sans-serif" }}>
              Dom Dom
            </div>
            <div style={{ fontSize: '12px', color: '#6BA3D4', marginTop: '5px' }}>
              ì™¸êµ­ì¸ ë…¸ë™ì ë„ìš°ë¯¸ ì•±
            </div>
          </div>

          {/* ë’¤ë¡œê°€ê¸° ë²„íŠ¼ */}
          <div style={{ backgroundColor: '#ffffff', display: 'flex', padding: '15px 20px', boxShadow: '0 2px 4px rgba(0,0,0,0.05)' }}>
            <button
              onClick={() => window.history.back()}
              style={{ display: 'flex', alignItems: 'center', gap: '5px', cursor: 'pointer', color: '#333', fontSize: '14px', fontWeight: '600', background: 'none', border: 'none' }}
            >
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" style={{ width: '24px', height: '24px' }}>
                <path d="M19 12H5M12 19l-7-7 7-7"/>
              </svg>
              <span>í™ˆìœ¼ë¡œ</span>
            </button>
          </div>

          {/* í”„ë¡œí•„ ì¹´ë“œ */}
          <div style={{ backgroundColor: '#ffffff', padding: '20px', margin: '20px', borderRadius: '12px', boxShadow: '0 2px 8px rgba(0,0,0,0.08)' }}>
            <div style={{ display: 'flex', alignItems: 'start', justifyContent: 'space-between' }}>
              <div style={{ display: 'flex', alignItems: 'center', gap: '15px' }}>
                <div style={{ position: 'relative', cursor: 'pointer' }} onClick={() => setShowEmojiPicker(!showEmojiPicker)}>
                  <div style={{ width: '70px', height: '70px', background: 'linear-gradient(135deg, #6BA3D4 0%, #5a8cbd 100%)', borderRadius: '12px', display: 'flex', alignItems: 'center', justifyContent: 'center', fontSize: '36px', boxShadow: '0 2px 8px rgba(0,0,0,0.1)' }}>
                    {user.profileEmoji}
                  </div>
                  <div style={{ position: 'absolute', bottom: '-2px', right: '-2px', backgroundColor: 'white', borderRadius: '50%', padding: '4px', boxShadow: '0 2px 4px rgba(0,0,0,0.1)' }}>
                    <Camera size={12} color="#6BA3D4" />
                  </div>
                </div>

                {showEmojiPicker && (
                  <div style={{ position: 'absolute', top: '160px', left: '40px', backgroundColor: 'white', borderRadius: '12px', boxShadow: '0 4px 12px rgba(0,0,0,0.15)', padding: '15px', display: 'grid', gridTemplateColumns: 'repeat(4, 1fr)', gap: '8px', zIndex: 50 }}>
                    {emojis.map((emoji, idx) => (
                      <button
                        key={idx}
                        onClick={() => selectEmoji(emoji)}
                        style={{ fontSize: '28px', background: 'none', border: 'none', cursor: 'pointer', padding: '5px' }}
                      >
                        {emoji}
                      </button>
                    ))}
                  </div>
                )}

                <div>
                  {editingName ? (
                    <div style={{ display: 'flex', alignItems: 'center', gap: '8px' }}>
                      <input
                        type="text"
                        value={tempName}
                        onChange={(e) => setTempName(e.target.value)}
                        style={{ border: '2px solid #6BA3D4', borderRadius: '8px', padding: '6px 10px', fontSize: '16px', fontWeight: '700' }}
                        autoFocus
                      />
                      <button
                        onClick={saveName}
                        style={{ backgroundColor: '#6BA3D4', color: 'white', padding: '6px 12px', borderRadius: '8px', fontWeight: '600', border: 'none', cursor: 'pointer' }}
                      >
                        ì €ì¥
                      </button>
                    </div>
                  ) : (
                    <div style={{ display: 'flex', alignItems: 'center', gap: '8px', cursor: 'pointer' }} onClick={() => { setEditingName(true); setTempName(user.name); }}>
                      <h2 style={{ fontSize: '20px', fontWeight: '700', color: '#333', margin: 0 }}>{user.name}</h2>
                      <Edit2 size={16} color="#999" />
                    </div>
                  )}
                  <div style={{ display: 'flex', alignItems: 'center', gap: '6px', marginTop: '4px' }}>
                    <span style={{ color: '#6BA3D4', fontWeight: '700', fontSize: '14px' }}>{getLevelName(user.level)} Lv.{user.level}</span>
                    <Sparkles size={14} color="#fbbf24" />
                  </div>
                </div>
              </div>

              <div style={{ textAlign: 'right' }}>
                <div style={{ display: 'flex', alignItems: 'center', gap: '6px', justifyContent: 'flex-end', marginBottom: '4px' }}>
                  <span style={{ fontSize: '24px' }}>ğŸ”¥</span>
                  <span style={{ fontSize: '20px', fontWeight: '700', color: '#f97316' }}>{user.streak}ì¼</span>
                </div>
                <p style={{ fontSize: '12px', color: '#666', margin: '4px 0 0 0' }}>ì—°ì† ì¶œì„</p>
                <p style={{ fontSize: '11px', color: '#999', margin: '2px 0 0 0' }}>ì´ {user.totalPoints}ì </p>
              </div>
            </div>

            <div style={{ marginTop: '20px' }}>
              <div style={{ display: 'flex', justifyContent: 'space-between', fontSize: '12px', color: '#666', marginBottom: '8px' }}>
                <span style={{ fontWeight: '600' }}>ê²½í—˜ì¹˜</span>
                <span style={{ fontWeight: '700' }}>{user.exp % 50} / 50</span>
              </div>
              <div style={{ width: '100%', backgroundColor: '#e5e7eb', borderRadius: '999px', height: '12px', overflow: 'hidden' }}>
                <div 
                  style={{ 
                    background: 'linear-gradient(to right, #f87171, #ef4444, #dc2626)', 
                    height: '12px', 
                    borderRadius: '999px', 
                    width: `${getProgressPercent()}%`,
                    transition: 'width 0.7s ease-out'
                  }}
                />
              </div>
            </div>
          </div>

          {/* ì¶œì„ ì²´í¬ ì¹´ë“œ */}
          <div style={{ backgroundColor: '#ffffff', padding: '20px', margin: '20px', borderRadius: '12px', boxShadow: '0 2px 8px rgba(0,0,0,0.08)' }}>
            <div style={{ display: 'flex', alignItems: 'center', justifyContent: 'space-between', marginBottom: '20px' }}>
              <div style={{ display: 'flex', alignItems: 'center', gap: '10px' }}>
                <Calendar color="#6BA3D4" size={24} />
                <h3 style={{ fontSize: '18px', fontWeight: '700', color: '#333', margin: 0 }}>ì¶œì„ ì²´í¬</h3>
              </div>
              <button
                onClick={() => setShowAttendanceCalendar(!showAttendanceCalendar)}
                style={{ fontSize: '12px', color: '#6BA3D4', fontWeight: '600', background: 'none', border: 'none', cursor: 'pointer' }}
              >
                {showAttendanceCalendar ? 'ì ‘ê¸°' : 'ì „ì²´ë³´ê¸°'}
              </button>
            </div>

            <div style={{ display: 'grid', gridTemplateColumns: 'repeat(7, 1fr)', gap: '8px', marginBottom: '20px' }}>
              {[1, 2, 3, 4, 5, 6, 7].map((day) => (
                <div key={day} style={{ textAlign: 'center' }}>
                  <div style={{
                    height: '60px',
                    borderRadius: '10px',
                    display: 'flex',
                    flexDirection: 'column',
                    alignItems: 'center',
                    justifyContent: 'center',
                    fontWeight: '700',
                    background: day <= user.streak ? 'linear-gradient(135deg, #fb923c 0%, #ec4899 100%)' : '#f3f4f6',
                    color: day <= user.streak ? 'white' : '#9ca3af',
                    boxShadow: day <= user.streak ? '0 2px 8px rgba(251, 146, 60, 0.3)' : 'none'
                  }}>
                    <span style={{ fontSize: '20px', marginBottom: '2px' }}>{day <= user.streak ? 'âœ“' : day}</span>
                    <span style={{ fontSize: '10px' }}>Day</span>
                  </div>
                </div>
              ))}
            </div>

            {showAttendanceCalendar && (
              <div style={{ backgroundColor: '#f8f9fa', borderRadius: '12px', padding: '15px', marginBottom: '15px' }}>
                <div style={{ display: 'flex', alignItems: 'center', justifyContent: 'space-between', marginBottom: '15px' }}>
                  <button
                    onClick={goToPreviousMonth}
                    style={{ width: '32px', height: '32px', borderRadius: '50%', backgroundColor: '#6BA3D4', border: 'none', cursor: 'pointer', color: 'white', fontWeight: '700' }}
                  >
                    â†
                  </button>
                  <h4 style={{ fontWeight: '700', color: '#333', fontSize: '16px', margin: 0 }}>{calendarYear}ë…„ {getMonthName(calendarMonth)}</h4>
                  <button
                    onClick={goToNextMonth}
                    style={{ width: '32px', height: '32px', borderRadius: '50%', backgroundColor: '#6BA3D4', border: 'none', cursor: 'pointer', color: 'white', fontWeight: '700' }}
                  >
                    â†’
                  </button>
                </div>
                
                <div style={{ display: 'grid', gridTemplateColumns: 'repeat(7, 1fr)', gap: '10px', marginBottom: '10px' }}>
                  {['ì¼', 'ì›”', 'í™”', 'ìˆ˜', 'ëª©', 'ê¸ˆ', 'í† '].map((day, idx) => (
                    <div key={idx} style={{ textAlign: 'center', fontSize: '12px', fontWeight: '700', color: '#666' }}>
                      {day}
                    </div>
                  ))}
                </div>
                
                <div style={{ display: 'grid', gridTemplateColumns: 'repeat(7, 1fr)', gap: '10px' }}>
                  {getCalendarDays().map((day, idx) => (
                    <div
                      key={idx}
                      style={{ 
                        position: 'relative', 
                        aspectRatio: '1', 
                        display: 'flex', 
                        alignItems: 'center', 
                        justifyContent: 'center',
                        borderRadius: '50%',
                        backgroundColor: (() => {
                          if (day.isEmpty) return 'transparent';
                          const date = new Date(calendarYear, calendarMonth, day.date);
                          const dateString = date.toDateString();
                          const hasQuiz = user.quizHistory[dateString];
                          if (hasQuiz) return '#ef4444';
                          if (day.attended) return '#6BA3D4';
                          return 'transparent';
                        })()
                      }}
                    >
                      {!day.isEmpty && (
                        <>
                          <span style={{ 
                            fontSize: '12px', 
                            fontWeight: '600', 
                            color: (() => {
                              const date = new Date(calendarYear, calendarMonth, day.date);
                              const dateString = date.toDateString();
                              const hasQuiz = user.quizHistory[dateString];
                              if (hasQuiz || day.attended) return 'white';
                              if (day.isToday) return '#6BA3D4';
                              return '#333';
                            })()
                          }}>
                            {day.date}
                          </span>
                          {day.isToday && !day.attended && !user.quizHistory[new Date(calendarYear, calendarMonth, day.date).toDateString()] && (
                            <div style={{ position: 'absolute', inset: 0, borderRadius: '50%', border: '2px solid #6BA3D4', pointerEvents: 'none' }}></div>
                          )}
                        </>
                      )}
                    </div>
                  ))}
                </div>
              </div>
            )}

            {getStreakReward(user.streak) && (
              <div style={{ background: 'linear-gradient(to right, #fef3c7, #fed7aa)', borderRadius: '12px', padding: '15px', display: 'flex', alignItems: 'center', gap: '15px' }}>
                <span style={{ fontSize: '32px' }}>{getStreakReward(user.streak).icon}</span>
                <div style={{ flex: 1 }}>
                  <p style={{ fontWeight: '700', color: '#333', margin: '0 0 4px 0' }}>{getStreakReward(user.streak).text}</p>
                  <p style={{ fontSize: '12px', color: '#666', margin: 0 }}>+{getStreakReward(user.streak).points} ë³´ë„ˆìŠ¤ í¬ì¸íŠ¸!</p>
                </div>
                <Gift color="#f97316" size={28} />
              </div>
            )}

            {!getStreakReward(user.streak) && (
              <p style={{ textAlign: 'center', fontSize: '12px', color: '#666', margin: 0 }}>
                <span style={{ fontWeight: '700', color: '#f97316' }}>{7 - user.streak}ì¼</span> ë” í•˜ë©´ ì²« ë³´ìƒ íšë“! ğŸ
              </p>
            )}
          </div>

          {/* í•œêµ­ì–´ í€´ì¦ˆ ë²„íŠ¼ */}
          <div style={{ padding: '0 20px 30px 20px' }}>
            <button
              onClick={() => setSelectedCategory('daily')}
              style={{ 
                width: '100%',
                backgroundColor: '#ffffff',
                borderRadius: '12px',
                padding: '25px 20px',
                border: 'none',
                cursor: 'pointer',
                boxShadow: '0 2px 8px rgba(0,0,0,0.08)',
                transition: 'all 0.3s'
              }}
            >
              <div style={{ display: 'flex', alignItems: 'center', justifyContent: 'space-between' }}>
                <div style={{ display: 'flex', alignItems: 'center', gap: '15px' }}>
                  <div style={{ fontSize: '50px' }}>ğŸ“’</div>
                  <div style={{ textAlign: 'left' }}>
                    <h3 style={{ fontSize: '22px', fontWeight: '700', color: '#333', margin: '0 0 8px 0' }}>í•œêµ­ì–´ í€´ì¦ˆ</h3>
                    <p style={{ color: '#666', fontSize: '13px', margin: 0 }}>ë§¤ì¼ ì¡°ê¸ˆì”©, ê¾¸ì¤€íˆ ì„±ì¥! ğŸ’ª</p>
                  </div>
                </div>
                <div style={{ fontSize: '20px', color: '#6BA3D4', fontWeight: '700' }}>â†’</div>
              </div>
            </button>
          </div>
        </div>
      </div>
    );
  }

  if (selectedCategory && !currentQuiz) {
    return (
      <div style={{ backgroundColor: '#f0f0f0', minHeight: '100vh', fontFamily: "'Noto Sans KR', -apple-system, BlinkMacSystemFont, sans-serif" }}>
        <div style={{ maxWidth: '430px', margin: '0 auto' }}>
          {/* í—¤ë” */}
          <div style={{ backgroundColor: '#ffffff', padding: '20px', textAlign: 'center', boxShadow: '0 2px 4px rgba(0,0,0,0.05)' }}>
            <div style={{ fontSize: '42px', fontWeight: '700', color: '#6BA3D4', letterSpacing: '1px', fontFamily: "'Arial Rounded MT Bold', Arial, sans-serif" }}>
              Dom Dom
            </div>
            <div style={{ fontSize: '12px', color: '#6BA3D4', marginTop: '5px' }}>
              ì™¸êµ­ì¸ ë…¸ë™ì ë„ìš°ë¯¸ ì•±
            </div>
          </div>

          {/* ë’¤ë¡œê°€ê¸° ë²„íŠ¼ */}
          <div style={{ backgroundColor: '#ffffff', display: 'flex', padding: '15px 20px', boxShadow: '0 2px 4px rgba(0,0,0,0.05)' }}>
            <button
              onClick={() => setSelectedCategory(null)}
              style={{ display: 'flex', alignItems: 'center', gap: '5px', cursor: 'pointer', color: '#333', fontSize: '14px', fontWeight: '600', background: 'none', border: 'none' }}
            >
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" style={{ width: '24px', height: '24px' }}>
                <path d="M19 12H5M12 19l-7-7 7-7"/>
              </svg>
              <span>ëŒì•„ê°€ê¸°</span>
            </button>
          </div>

          {/* ì œëª© */}
          <div style={{ backgroundColor: '#ffffff', padding: '20px', margin: '20px', borderRadius: '12px', textAlign: 'center', boxShadow: '0 2px 8px rgba(0,0,0,0.08)' }}>
            <div style={{ fontSize: '56px', marginBottom: '10px' }}>ğŸ’¬</div>
            <h2 style={{ fontSize: '22px', fontWeight: '700', color: '#333', margin: '0 0 8px 0' }}>í•œêµ­ì–´ í€´ì¦ˆ</h2>
            <p style={{ color: '#666', fontSize: '13px', margin: 0 }}>ë‚œì´ë„ë¥¼ ì„ íƒí•˜ì„¸ìš”!</p>
          </div>

          {/* ë‚œì´ë„ ì„ íƒ */}
          <div style={{ padding: '0 20px 30px 20px', display: 'flex', flexDirection: 'column', gap: '15px' }}>
            {['beginner', 'intermediate', 'advanced'].map((difficulty) => (
              <button
                key={difficulty}
                onClick={() => startQuiz('daily', difficulty)}
                style={{
                  backgroundColor: '#ffffff',
                  borderRadius: '12px',
                  padding: '20px',
                  border: 'none',
                  cursor: 'pointer',
                  boxShadow: '0 2px 8px rgba(0,0,0,0.08)',
                  transition: 'all 0.3s'
                }}
              >
                <div style={{ display: 'flex', alignItems: 'center', justifyContent: 'space-between' }}>
                  <div style={{ display: 'flex', alignItems: 'center', gap: '15px' }}>
                    <div style={{
                      width: '60px',
                      height: '60px',
                      background: difficulty === 'beginner' ? 'linear-gradient(135deg, #4ade80, #10b981)' : difficulty === 'intermediate' ? 'linear-gradient(135deg, #60a5fa, #3b82f6)' : 'linear-gradient(135deg, #a78bfa, #ec4899)',
                      borderRadius: '12px',
                      display: 'flex',
                      alignItems: 'center',
                      justifyContent: 'center',
                      color: 'white',
                      fontSize: '24px',
                      fontWeight: '700',
                      boxShadow: '0 2px 8px rgba(0,0,0,0.1)'
                    }}>
                      {difficulty === 'beginner' ? '1' : difficulty === 'intermediate' ? '2' : '3'}
                    </div>
                    <div style={{ textAlign: 'left' }}>
                      <h3 style={{ fontSize: '18px', fontWeight: '700', color: '#333', margin: '0 0 4px 0' }}>{getDifficultyText(difficulty)}</h3>
                      <p style={{ fontSize: '12px', color: '#666', margin: 0 }}>
                        {difficulty === 'beginner' && 'ê¸°ì´ˆë¶€í„° ì°¨ê·¼ì°¨ê·¼'}
                        {difficulty === 'intermediate' && 'ì‹¤ë ¥ì„ í•œ ë‹¨ê³„ ì˜¬ë ¤ìš”'}
                        {difficulty === 'advanced' && 'ì „ë¬¸ê°€ ë ˆë²¨ ë„ì „!'}
                      </p>
                    </div>
                  </div>
                  <div style={{ fontSize: '32px' }}>
                    {difficulty === 'beginner' && 'ğŸŒ±'}
                    {difficulty === 'intermediate' && 'ğŸŒ¿'}
                    {difficulty === 'advanced' && 'ğŸŒ³'}
                  </div>
                </div>
              </button>
            ))}
          </div>
        </div>
      </div>
    );
  }

  return (
    <div style={{ backgroundColor: '#f0f0f0', minHeight: '100vh', fontFamily: "'Noto Sans KR', -apple-system, BlinkMacSystemFont, sans-serif" }}>
      <div style={{ maxWidth: '430px', margin: '0 auto' }}>
        {/* í—¤ë” */}
        <div style={{ backgroundColor: '#ffffff', padding: '20px', textAlign: 'center', boxShadow: '0 2px 4px rgba(0,0,0,0.05)' }}>
          <div style={{ fontSize: '42px', fontWeight: '700', color: '#6BA3D4', letterSpacing: '1px', fontFamily: "'Arial Rounded MT Bold', Arial, sans-serif" }}>
            Dom Dom
          </div>
          <div style={{ fontSize: '12px', color: '#6BA3D4', marginTop: '5px' }}>
            ì™¸êµ­ì¸ ë…¸ë™ì ë„ìš°ë¯¸ ì•±
          </div>
        </div>

        {/* ìœ ì € ì •ë³´ ë°” */}
        <div style={{ backgroundColor: '#ffffff', padding: '15px 20px', display: 'flex', alignItems: 'center', justifyContent: 'space-between', boxShadow: '0 2px 4px rgba(0,0,0,0.05)' }}>
          <div style={{ display: 'flex', alignItems: 'center', gap: '10px' }}>
            <div style={{
              width: '48px',
              height: '48px',
              background: 'linear-gradient(135deg, #6BA3D4, #5a8cbd)',
              borderRadius: '10px',
              display: 'flex',
              alignItems: 'center',
              justifyContent: 'center',
              fontSize: '24px'
            }}>
              {user.profileEmoji}
            </div>
            <div>
              <p style={{ fontWeight: '700', color: '#333', margin: 0, fontSize: '13px' }}>{getLevelName(user.level)} Lv.{user.level}</p>
              <p style={{ fontSize: '11px', color: '#666', margin: '2px 0 0 0' }}>{user.totalPoints}ì </p>
            </div>
          </div>
          <div style={{ display: 'flex', alignItems: 'center', gap: '6px', color: '#f97316' }}>
            <span style={{ fontSize: '18px' }}>ğŸ”¥</span>
            <span style={{ fontWeight: '700', fontSize: '14px' }}>{user.streak}ì¼</span>
          </div>
        </div>

        {/* ì‘ì› ë©”ì‹œì§€ */}
        <div style={{ textAlign: 'center', padding: '20px' }}>
          <div style={{ display: 'inline-block', backgroundColor: 'white', borderRadius: '12px', boxShadow: '0 2px 8px rgba(0,0,0,0.08)', padding: '12px 20px' }}>
            <p style={{ color: '#333', fontWeight: '600', margin: 0, fontSize: '13px', display: 'flex', alignItems: 'center', gap: '8px' }}>
              <span style={{ fontSize: '20px' }}>ğŸ’ª</span>
              <span>í™”ì´íŒ…! ë‹¹ì‹ ì€ í•  ìˆ˜ ìˆì–´ìš”!</span>
            </p>
          </div>
        </div>

        {/* í€´ì¦ˆ ì¹´ë“œ */}
        <div style={{ backgroundColor: '#ffffff', borderRadius: '12px', padding: '25px 20px', margin: '0 20px 30px 20px', boxShadow: '0 2px 8px rgba(0,0,0,0.08)' }}>
          <div style={{ display: 'flex', alignItems: 'center', justifyContent: 'space-between', marginBottom: '20px' }}>
            <span style={{
              padding: '8px 14px',
              borderRadius: '10px',
              fontSize: '12px',
              fontWeight: '700',
              color: 'white',
              background: 'linear-gradient(135deg, #6BA3D4, #5a8cbd)'
            }}>
              ğŸ’¬ í•œêµ­ì–´ í€´ì¦ˆ
            </span>
            <span style={{
              padding: '8px 14px',
              borderRadius: '10px',
              fontSize: '12px',
              fontWeight: '700',
              color: 'white',
              background: currentQuiz.difficulty === 'beginner' ? 'linear-gradient(135deg, #4ade80, #10b981)' : currentQuiz.difficulty === 'intermediate' ? 'linear-gradient(135deg, #60a5fa, #3b82f6)' : 'linear-gradient(135deg, #a78bfa, #ec4899)'
            }}>
              {getDifficultyText(currentQuiz.difficulty)}
            </span>
          </div>

          <h2 style={{ fontSize: '20px', fontWeight: '700', color: '#333', marginBottom: '25px', lineHeight: '1.5' }}>
            {currentQuiz.question}
          </h2>

          <div style={{ display: 'flex', flexDirection: 'column', gap: '10px', marginBottom: '25px' }}>
            {currentQuiz.answers.map((answer, index) => (
              <button
                key={index}
                onClick={() => !showResult && handleAnswer(index)}
                disabled={showResult}
                style={{
                  width: '100%',
                  padding: '16px',
                  borderRadius: '12px',
                  textAlign: 'left',
                  fontWeight: '600',
                  fontSize: '14px',
                  border: showResult ? 'none' : selectedAnswer === index ? '2px solid #6BA3D4' : '2px solid #e5e7eb',
                  background: showResult
                    ? index === currentQuiz.correct
                      ? 'linear-gradient(135deg, #4ade80, #10b981)'
                      : index === selectedAnswer
                      ? 'linear-gradient(135deg, #f87171, #ec4899)'
                      : '#f3f4f6'
                    : selectedAnswer === index
                    ? '#6BA3D4'
                    : '#ffffff',
                  color: showResult
                    ? index === currentQuiz.correct || index === selectedAnswer
                      ? 'white'
                      : '#9ca3af'
                    : selectedAnswer === index
                    ? 'white'
                    : '#333',
                  cursor: showResult ? 'default' : 'pointer',
                  boxShadow: selectedAnswer === index && !showResult ? '0 2px 8px rgba(107, 163, 212, 0.3)' : 'none',
                  transition: 'all 0.3s'
                }}
              >
                <div style={{ display: 'flex', alignItems: 'center', gap: '10px' }}>
                  <span style={{ fontSize: '16px', fontWeight: '700' }}>{String.fromCharCode(65 + index)}</span>
                  <span>{answer}</span>
                </div>
              </button>
            ))}
          </div>

          {!showResult ? (
            <button
              onClick={submitAnswer}
              disabled={selectedAnswer === null}
              style={{
                width: '100%',
                padding: '16px',
                borderRadius: '12px',
                fontWeight: '700',
                fontSize: '15px',
                color: 'white',
                border: 'none',
                cursor: selectedAnswer === null ? 'not-allowed' : 'pointer',
                background: selectedAnswer === null ? '#d1d5db' : 'linear-gradient(135deg, #6BA3D4, #5a8cbd)',
                boxShadow: selectedAnswer === null ? 'none' : '0 2px 8px rgba(107, 163, 212, 0.3)',
                transition: 'all 0.3s'
              }}
            >
              ë‹µë³€ ì œì¶œí•˜ê¸°
            </button>
          ) : (
            <div style={{ textAlign: 'center' }}>
              <div style={{
                marginBottom: '20px',
                padding: '20px',
                borderRadius: '12px',
                background: selectedAnswer === currentQuiz.correct
                  ? 'linear-gradient(to right, #d1fae5, #a7f3d0)'
                  : 'linear-gradient(to right, #fee2e2, #fecaca)',
                border: selectedAnswer === currentQuiz.correct ? '2px solid #10b981' : '2px solid #ef4444'
              }}>
                <p style={{ fontSize: '28px', fontWeight: '700', marginBottom: '10px' }}>
                  {selectedAnswer === currentQuiz.correct ? 'ğŸ‰ ì •ë‹µì…ë‹ˆë‹¤!' : 'ğŸ˜… í‹€ë ¸ìŠµë‹ˆë‹¤'}
                </p>
                <p style={{ fontSize: '14px', margin: 0 }}>
                  {selectedAnswer === currentQuiz.correct 
                    ? `+${currentQuiz.difficulty === 'advanced' ? 15 : currentQuiz.difficulty === 'intermediate' ? 12 : 10} ê²½í—˜ì¹˜ë¥¼ íšë“í–ˆìŠµë‹ˆë‹¤!` 
                    : `ì •ë‹µ: ${currentQuiz.answers[currentQuiz.correct]}`}
                </p>
              </div>
              <button
                onClick={() => setCurrentQuiz(null)}
                style={{
                  width: '100%',
                  background: 'linear-gradient(135deg, #6b7280, #4b5563)',
                  color: 'white',
                  fontWeight: '700',
                  padding: '16px',
                  borderRadius: '12px',
                  fontSize: '15px',
                  border: 'none',
                  cursor: 'pointer',
                  boxShadow: '0 2px 8px rgba(0,0,0,0.1)',
                  transition: 'all 0.3s'
                }}
              >
                ë©”ì¸ìœ¼ë¡œ ëŒì•„ê°€ê¸°
              </button>
            </div>
          )}
        </div>
      </div>
    </div>
  );
};

export default KoreanQuizApp;
